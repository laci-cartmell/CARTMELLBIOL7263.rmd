---
title: "PCAwR"
author: "Laci Cartmell"
date: "10/31/2022"
output: html_document
---


## What is PCA?

Principal Components Analysis (PCA)is the analysis of principal components that explain a large portion of the variation in a dataset.

Principal components are linear combinations of the original predictors in a dataset. Because of the orthogonal transformations, numerical data works the best. You could code categorical as continuous but better to use categorical variables later on for grouping.

The transformation fits data into a coordinate system with the most variance is in the first coordinate (component), the 2nd most variance in the second coordinate, and so on. 

# Plot of PC1 PC2 - OR TABLE IDK WHICH
```{r pressure, echo=FALSE}
plot(pressure)
```

## When to use a PCA?

Interactions between variables are often hidden especially w/complex data.

How do 10 variables interact with each other variable? We could make 45 pairwise scatterplots, but looking at them would be time consuming - or we could use PCA to find those interactions for us. 

# Plot of dataset - showing the complexity
```{r pressure, echo=FALSE}
plot(pressure)
```

PCA does multiple things at once: 

- Exploratory analysis 
    - Variable reduction - we find the total variance in the original dataset explained by each principal component
    -  do our categorical variables group?

- Model selection
  -  variable reduction
  -  PCR - Principle Component Regression
        - "baby machine learning"

The goal is to explain the most variability with fewer variables than we started with. If we can capture most of the variation in two dimensions, then we can project all the observations onto a scatterplot - 


## PCA in R

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("ggfortify")
# Iris dataset - 3 species, 50 samples each
str(iris)
summary(iris)
describe(iris, TRUE)
View(iris)

# remove categorical variable
Iris_pca <- subset(iris, select = -c(Species))

# PCA
Iris_pca <- prcomp(Iris_pca,
                   center = TRUE,   # mean of 0
                   scale. = TRUE)   # STD of 1
summary(Iris_pca)
str(Iris_pca)
  

#Plotting a PCA - checks for linearity and normality
library(ggfortify)
#plots PC1,PC2 automatically
iris_pca_plot <- autoplot(Iris_pca,
                          data = iris,
                          colour = 'Species'
                          )
iris_pca_plot


# biplot - how components were combined
biplot_iris_pca <- biplot(iris.pca)
biplot_iris_pca

# screeplot - how many components to keep
plot_iris_pca <- plot(Iris_pca, type="l")
plot_iris_pca
```



## When to use a 3-D PCA?
     USE MY GIS DATA HERE, SHOULD BE ENOUGH TO COVER 
## Including Plots
embed plots, for example:

```{r pressure, echo=FALSE}
# Packages
install.packages("devtools", "ggfortify", "remotes", "writexl ")

#read in file

library(readxl)
NLCD_Land_cover_gisanalysis <- read_excel("F:/nlcd_land_cover_l48_20210604/NLCD_Land_cover_gisanalysis.xlsx", sheet ="Sheet5")
summary(NLCD_Land_cover_gisanalysis)
datatable <- NLCD_Land_cover_gisanalysis

#list of colonynames
library(readxl)
colonynames <- read_excel("F:/nlcd_land_cover_l48_20210604/colonynames_analysis.xlsx", 
                                   sheet = "colonynames_analysis")
View(colonynames)

#  SPECIFY SUBSTRATE/YEAR/COLONYNAME AS FACTOR VARS, INDICATE BASE FOR SUBSTRATE AND YEAR
datatable$Substrate <- as.factor(datatable$Substrate)
#contrasts(datatable$Substrate) <- contr.treatment(c(".1", ".2", ".3", ".4"), base=4)

datatable$Year <- as.factor(datatable$Year)
#contrasts(datatable$Year) <- contr.treatment(c("2001", "2004", "2006", "2008", "2013", "2016", "2019"), base=1)

datatable$COLONYNAME = factor(datatable$COLONYNAME,
                              levels = unique(datatable$COLONYNAME))
summary(datatable)
install.packages("writexl")
require(writexl)

write_xlsx(datatable, "C:\\MyLocation\\datatable2.xlsx")

#Check for NaN or Inf and replace with NA if present
#is all a variable NA
all(is.na(datatable$Size))
#Replace NaN & Inf with NA
datatable[is.na(datatable) | datatable=="-Inf"] = NA

# rank in r - ranking our df by H_P 
df %>%
  +   group_by(COLONYNAME) %>%
  +   mutate(good_ranks = order(order(Hay_Pasture, decreasing=TRUE)))
rank(datatable,ties.method = "first")

###################
#### DATA VISUALIZATION
###################
#
# PCA 
#
data <- datatable[,c(18:28)]
str(data)
head(data)
summary(data)
data.pca <- prcomp(datatable[,c(16:26)], center = TRUE, scale. = TRUE)
summary(data.pca)
#PC1 explains 22% of the total variance

#look at PCA object
str(data.pca)

#plotting pca
# loading library
install.packages("ggfortify")
library(ggfortify)
data.pca.plot <- autoplot(data.pca,
                          data = datatable,
                          colour = 'Size')
data.pca.plot2 <- autoplot(data.pca,
                          data = datatable,
                          colour = 'Substrate')
data.pca.plot
summary(datatable)
biplot.data.pca <- biplot(data.pca)
biplot.data.pca

#how many components
plot.data.pca <- plot(data.pca, type="1")
plot.data.pca
install.packages("devtools")
library(devtools)
Sys.setenv(R_REMOTES_NO_ERRORS_FROM_WARNINGS="true")
install.packages("remotes")
remotes::install_github("vqv/ggbiplot")
install_github("vqv/ggbiplot")
library(ggbiplot)

ggbiplot(data.pca)

#label each point with year
ggbiplot(data.pca, label = datatable$Year)


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
